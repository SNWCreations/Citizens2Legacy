From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?ZX=E5=A4=8F=E5=A4=9C=E4=B9=8B=E9=A3=8E?=
 <snwcreations@qq.com>
Date: Thu, 19 Sep 2024 11:37:53 +0800
Subject: [PATCH] fix: backport implementation of NMS#getRidingHeightOffset for
 Minecraft 1.20.1


diff --git a/v1_20_R4/src/main/java/net/citizensnpcs/nms/v1_20_R4/util/NMSImpl.java b/v1_20_R4/src/main/java/net/citizensnpcs/nms/v1_20_R4/util/NMSImpl.java
index 2eb7d18aea834c7c6108763b766783be1c743901..da36aa90a316f46bc7406949e9a72c857c83c88a 100644
--- a/v1_20_R4/src/main/java/net/citizensnpcs/nms/v1_20_R4/util/NMSImpl.java
+++ b/v1_20_R4/src/main/java/net/citizensnpcs/nms/v1_20_R4/util/NMSImpl.java
@@ -775,8 +775,13 @@ public class NMSImpl implements NMSBridge {
 
     @Override
     public float getRidingHeightOffset(org.bukkit.entity.Entity entity, org.bukkit.entity.Entity mount) {
+        // Backport start - Re-implement getRidingHeightOffset using MC 1.20.1 method
+        /*
         Entity handle = getHandle(entity);
         return (float) (handle.getPassengerRidingPosition(getHandle(mount)).y - handle.position().y);
+        */
+        return (float) getHandle(mount).getPassengersRidingOffset();
+        // Backport end
     }
 
     @Override
